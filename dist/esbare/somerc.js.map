{"version":3,"file":"somerc.js","sources":["../../../proj4js/lib/projections/somerc.js","../../projections/somerc.js"],"sourcesContent":["/*\n  references:\n    Formules et constantes pour le Calcul pour la\n    projection cylindrique conforme à axe oblique et pour la transformation entre\n    des systèmes de référence.\n    http://www.swisstopo.admin.ch/internet/swisstopo/fr/home/topics/survey/sys/refsys/switzerland.parsysrelated1.31216.downloadList.77004.DownloadFile.tmp/swissprojectionfr.pdf\n  */\n\nexport function init() {\n  var phy0 = this.lat0;\n  this.lambda0 = this.long0;\n  var sinPhy0 = Math.sin(phy0);\n  var semiMajorAxis = this.a;\n  var invF = this.rf;\n  var flattening = 1 / invF;\n  var e2 = 2 * flattening - Math.pow(flattening, 2);\n  var e = this.e = Math.sqrt(e2);\n  this.R = this.k0 * semiMajorAxis * Math.sqrt(1 - e2) / (1 - e2 * Math.pow(sinPhy0, 2));\n  this.alpha = Math.sqrt(1 + e2 / (1 - e2) * Math.pow(Math.cos(phy0), 4));\n  this.b0 = Math.asin(sinPhy0 / this.alpha);\n  var k1 = Math.log(Math.tan(Math.PI / 4 + this.b0 / 2));\n  var k2 = Math.log(Math.tan(Math.PI / 4 + phy0 / 2));\n  var k3 = Math.log((1 + e * sinPhy0) / (1 - e * sinPhy0));\n  this.K = k1 - this.alpha * k2 + this.alpha * e / 2 * k3;\n}\n\nexport function forward(p) {\n  var Sa1 = Math.log(Math.tan(Math.PI / 4 - p.y / 2));\n  var Sa2 = this.e / 2 * Math.log((1 + this.e * Math.sin(p.y)) / (1 - this.e * Math.sin(p.y)));\n  var S = -this.alpha * (Sa1 + Sa2) + this.K;\n\n  // spheric latitude\n  var b = 2 * (Math.atan(Math.exp(S)) - Math.PI / 4);\n\n  // spheric longitude\n  var I = this.alpha * (p.x - this.lambda0);\n\n  // psoeudo equatorial rotation\n  var rotI = Math.atan(Math.sin(I) / (Math.sin(this.b0) * Math.tan(b) + Math.cos(this.b0) * Math.cos(I)));\n\n  var rotB = Math.asin(Math.cos(this.b0) * Math.sin(b) - Math.sin(this.b0) * Math.cos(b) * Math.cos(I));\n\n  p.y = this.R / 2 * Math.log((1 + Math.sin(rotB)) / (1 - Math.sin(rotB))) + this.y0;\n  p.x = this.R * rotI + this.x0;\n  return p;\n}\n\nexport function inverse(p) {\n  var Y = p.x - this.x0;\n  var X = p.y - this.y0;\n\n  var rotI = Y / this.R;\n  var rotB = 2 * (Math.atan(Math.exp(X / this.R)) - Math.PI / 4);\n\n  var b = Math.asin(Math.cos(this.b0) * Math.sin(rotB) + Math.sin(this.b0) * Math.cos(rotB) * Math.cos(rotI));\n  var I = Math.atan(Math.sin(rotI) / (Math.cos(this.b0) * Math.cos(rotI) - Math.sin(this.b0) * Math.tan(rotB)));\n\n  var lambda = this.lambda0 + I / this.alpha;\n\n  var S = 0;\n  var phy = b;\n  var prevPhy = -1000;\n  var iteration = 0;\n  while (Math.abs(phy - prevPhy) > 0.0000001) {\n    if (++iteration > 20) {\n      //...reportError(\"omercFwdInfinity\");\n      return;\n    }\n    //S = Math.log(Math.tan(Math.PI / 4 + phy / 2));\n    S = 1 / this.alpha * (Math.log(Math.tan(Math.PI / 4 + b / 2)) - this.K) + this.e * Math.log(Math.tan(Math.PI / 4 + Math.asin(this.e * Math.sin(phy)) / 2));\n    prevPhy = phy;\n    phy = 2 * Math.atan(Math.exp(S)) - Math.PI / 2;\n  }\n\n  p.x = lambda;\n  p.y = phy;\n  return p;\n}\n\nexport var names = [\"somerc\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names\n};\n","import somerc from '../../proj4js/lib/projections/somerc.js';\nimport projections from '../../proj4js/lib/projections.js';\n\nprojections.add(somerc);\n"],"names":["init","phy0","this","lat0","lambda0","long0","sinPhy0","Math","sin","semiMajorAxis","a","flattening","rf","e2","pow","e","sqrt","R","k0","alpha","cos","b0","asin","k1","log","tan","PI","k2","k3","K","forward","p","Sa1","y","Sa2","S","b","atan","exp","I","x","rotI","rotB","y0","x0","inverse","Y","X","lambda","phy","prevPhy","iteration","abs","names","projections","add","somerc"],"mappings":"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"}